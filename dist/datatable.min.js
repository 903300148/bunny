var DataTableConfig={ajax:Ajax,template:Template,pagination:Pagination,tagName:"datatable",attrUrl:"url",attrTemplate:"template",tagNamePagination:"pagination",tagNameStats:"stats",perPage:15,paginationLimit:7,loadingImg:"/img/loading.svg",ajaxHeaders:[]},DataTable={_config:DataTableConfig,_collection:[],init:function(t){t.__bunny_loadingIcon=this.addLoadingIcon(t),this._collection.push(t);var a=BunnyURL.getParam("page");void 0===a&&(a=1),this.changePage(t,a,this.getSearchDataFromURL(t)),this.addEvents(t)},addEvents:function(t){var a=this,n=this.getSearchInput(t);n&&addEventOnce(n,"input",function(){a.search(t,n.value)})},getSearchInput:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"search";return t.querySelector('[name="'+a+'"]')||!1},getDataUrl:function(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e=this._config.pagination.addPageParamToUrl(this.getAjaxUrl(t),a);for(var i in n)e+="&"+i+"="+n[i];return e},fetchData:function(t,a){var n=this;return new Promise(function(t){n._config.ajax.get(a,function(a){a=JSON.parse(a),t(a)},{},n.getAjaxHeaders())})},initAll:function(){var t=this;ready(function(){[].forEach.call(document.getElementsByTagName(t._config.tagName),function(a){t.init(a)})})},isInitiated:function(t){return this._collection.forEach(function(a){if(a===t)return!0}),!1},getTemplateId:function(t){return t.getAttribute(this._config.attrTemplate)},getAjaxUrl:function(t){return t.getAttribute(this._config.attrUrl)},getAjaxHeaders:function(){var t={};return DataTableConfig.ajaxHeaders.forEach(function(a){var n=a.split(": ");t[n[0]]=n[1]}),t},getTable:function(t){return t.getElementsByTagName("table")[0]},getPagination:function(t){return t.getElementsByTagName(this._config.tagNamePagination)[0]},getStats:function(t){return t.getElementsByTagName(this._config.tagNameStats)[0]},addAjaxHeader:function(t){this._config.ajaxHeaders.push(t)},attachPaginationEventHandlers:function(t){var a=this,n=this.getPagination(t);this._config.pagination.onItemClick(n,function(n,e){a.changePage(t,n)})},removeRows:function(t){for(var a=this.getTable(t),n=a.rows.length,e=n-1;e>0;e--)a.deleteRow(e)},insertRows:function(t,a){this._config.template.insertAll(this.getTemplateId(t),a,this.getTable(t))},callHandlers:function(t,a){void 0!==t.callbacks&&t.callbacks.forEach(function(t){t(a)})},changePage:function(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=this.getSearchData(t)),this.update(t,this.getDataUrl(t,a,n))},getSearchData:function(t){var a=this.getSearchInput(t),n={};return a&&a.value.length>0&&(n.search=a.value),n},getSearchDataFromURL:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href,n=BunnyURL.getParams(a),e={};for(var i in n)if("page"!==i){var o=this.getSearchInput(t,i);o&&(o.value=n[i],e[i]=n[i])}return e},search:function(t,a){this.update(t,this.getDataUrl(t,1,{search:a}))},updateURL:function(t,a){window.history.pushState("","",a)},update:function(t,a){var n=this;this.getTable(t).classList.remove("active"),t.__bunny_loadingIcon=this.addLoadingIcon(t),BunnyElement.scrollTo(t,500,-100),this.fetchData(t,a).then(function(e){var i=n.getPagination(t),o=n._config.pagination;o.initOrUpdate(i,e),n.attachPaginationEventHandlers(t);var r=n.getStats(t);void 0!==r&&(r.textContent=o.getStats(i)),n.removeRows(t),n.insertRows(t,e.data),n.callHandlers(t,e),n.getTable(t).classList.add("active"),n.updateURL(t,a),n.removeLoadingIcon(t)})},onRedraw:function(t,a){void 0===t.callbacks&&(t.callbacks=[]),t.callbacks.push(a)},addLoadingIcon:function(t){if(void 0!==t.__bunny_loadingIcon)return t.__bunny_loadingIcon;var a=new Image;return a.src=this._config.loadingImg,a.style.opacity=.5,a.style.position="absolute",a.style.top="30%",a.style.left="50%",t.appendChild(a),a},removeLoadingIcon:function(t){t.removeChild(t.__bunny_loadingIcon),delete t.__bunny_loadingIcon}};DataTable.initAll();