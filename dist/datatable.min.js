function getActionObject(t){var a=t.getAttribute("action"),e=a.split("."),n=e[0],i=null;if(void 0===e[1])i=window[n];else{var r=e[1];try{i=window[n][r]}catch(t){}}if(void 0===i)throw new Error('Bunny Error: Model search action specified in action="'+a+'" attribute not found');return i}function initObjectExtensions(t,a){var e=Object.keys(t);e.forEach(function(e){0===e.indexOf("init")&&t[e](a)})}function pushToElementProperty(t,a,e){void 0===t[a]&&(t[a]=[]),t[a].push(e)}function pushCallbackToElement(t,a,e){pushToElementProperty(t,"__bunny_"+a+"_callbacks",e)}function callElementCallbacks(t,a,e){var n=t["__bunny_"+a+"_callbacks"];void 0!==n&&!function(){var t=function t(a){var i=e(n[a]);i instanceof Promise?i.then(function(e){e!==!1&&a>0&&t(a-1)}):i!==!1&&a>0&&t(a-1)};t(n.length-1)}()}var DataTableConfig={tagName:"datatable",attrUrl:"url",attrTemplate:"template",tagNamePagination:"pagination",tagNameStats:"stats",perPage:15,paginationLimit:7,loadingImg:"/img/loading.svg",ajaxHeaders:[]},DataTableUI={Config:DataTableConfig,Template:Template,getSearchInput:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"search";return t.querySelector('[name="'+a+'"]')||!1},getTable:function(t){return t.getElementsByTagName("table")[0]},getPagination:function(t){return t.getElementsByTagName(this.Config.tagNamePagination)[0]},getStats:function(t){return t.getElementsByTagName(this.Config.tagNameStats)[0]},removeRows:function(t){for(var a=this.getTable(t),e=a.rows.length,n=e-1;n>0;n--)a.deleteRow(n)},insertRows:function(t,a,e){this.Template.insertAll(e,a,this.getTable(t))}},DataTable={Config:DataTableConfig,UI:DataTableUI,Ajax:Ajax,Pagination:Pagination,init:function(t){if(void 0!==t.__bunny_datatable)return!1;t.__bunny_datatable={};var a=BunnyURL.getParam("page");return void 0===a&&(a=1),this.addEvents(t),initObjectExtensions(this,t),this.changePage(t,a,this.getSearchDataFromURL(t)),!0},initAll:function(){var t=this;ready(function(){[].forEach.call(document.getElementsByTagName(t.Config.tagName),function(a){t.init(a)})})},isInitiated:function(t){return void 0!==t.__bunny_datatable},getTemplateId:function(t){return t.getAttribute(this.Config.attrTemplate)},getAjaxUrl:function(t){return t.getAttribute(this.Config.attrUrl)},getAjaxHeaders:function(){var t={};return DataTableConfig.ajaxHeaders.forEach(function(a){var e=a.split(": ");t[e[0]]=e[1]}),t},addAjaxHeader:function(t){this.Config.ajaxHeaders.push(t)},getSearchData:function(t){var a=this.UI.getSearchInput(t),e={};return a&&a.value.length>0&&(e.search=a.value),e},getSearchDataFromURL:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href,e=BunnyURL.getParams(a),n={};for(var i in e)if("page"!==i){var r=this.UI.getSearchInput(t,i);r&&(r.value=e[i],n[i]=e[i])}return n},getDataUrl:function(t,a){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this.Pagination.addPageParamToUrl(this.getAjaxUrl(t),a);for(var i in e)n+="&"+i+"="+e[i];return n},addEvents:function(t){var a=this,e=this.UI.getSearchInput(t);e&&addEventOnce(e,"input",function(){a.search(t,e.value)})},attachPaginationEventHandlers:function(t){var a=this,e=this.UI.getPagination(t);this.Pagination.onItemClick(e,function(e,n){a.changePage(t,e)})},callHandlers:function(t,a){callElementCallbacks(t,"datatable_redraw",function(t){t(a)})},callBeforeHandlers:function(t,a){callElementCallbacks(t,"datatable_before_redraw",function(t){t(a)})},onBeforeRedraw:function(t,a){pushCallbackToElement(t,"datatable_before_redraw",a)},onRedraw:function(t,a){pushCallbackToElement(t,"datatable_redraw",a)},fetchData:function(t,a){var e=this;return new Promise(function(t){e.Ajax.get(a,function(a){a=JSON.parse(a),t(a)},{},e.getAjaxHeaders())})},changePage:function(t,a){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===e&&(e=this.getSearchData(t)),this.update(t,this.getDataUrl(t,a,e))},search:function(t,a){this.update(t,this.getDataUrl(t,1,{search:a}))},updateURL:function(t,a){var e=window.location.href,n=BunnyURL.getParam("page",a);n>1?e=BunnyURL.setParam("page",n):BunnyURL.hasParam("page",e)&&(e=BunnyURL.removeParam("page",e));var i=BunnyURL.getParam("search",a);i&&""!==i?e=BunnyURL.setParam("search",i,e):BunnyURL.hasParam("search",e)&&(e=BunnyURL.removeParam("search",e)),e!==window.location.href&&window.history.replaceState("","",e)},update:function(t,a){var e=this;this.callBeforeHandlers(t),this.UI.getTable(t).classList.remove("in"),this.fetchData(t,a).then(function(n){var i=e.UI.getPagination(t),r=e.Pagination;r.initOrUpdate(i,n),e.attachPaginationEventHandlers(t);var o=e.UI.getStats(t);void 0!==o&&(o.textContent=r.getStats(i)),e.UI.removeRows(t),e.UI.insertRows(t,n.data,e.getTemplateId(t)),e.UI.getTable(t).classList.add("in"),e.updateURL(t,a),e.callHandlers(t,n)})}};DataTable.initAll();